{% extends "base.html" %}
{% block title %}åº—èˆ—ä¸€è¦§ | NAGOYAMESHI{% endblock %}

{% block content %}
\u003ch1 class=\"mb-4 text-center\"\u003eğŸ½ï¸ NAGOYAMESHI\u003c/h1\u003e

\u003c!-- â–¼ æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  â–¼ --\u003e
\u003cdiv class=\"search-container\"\u003e
\u003c!-- æ¤œç´¢å‰ã¾ãŸã¯æ¤œç´¢å¾Œã§è¡¨ç¤ºã‚’å¤‰ãˆã‚‹ --\u003e
{% if request.GET %}
\u003c!-- æ¤œç´¢å¾Œï¼šã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªãƒ•ã‚©ãƒ¼ãƒ  --\u003e
\u003cform method=\"get\" class=\"row g-2 mb-4\"\u003e
{% else %}
\u003c!-- æ¤œç´¢å‰ï¼šå¤§ããªæ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  --\u003e
\u003cform method=\"get\" class=\"search-form-large mb-5\"\u003e
\u003ch3 class=\"text-center mb-4\"\u003eãŠåº—ã‚’æ¤œç´¢\u003c/h3\u003e
{% endif %}

\u003cdiv class=\"{% if request.GET %}col-md-2{% else %}search-field{% endif %}\"\u003e
\u003clabel class=\"form-label\"\u003eéƒ½é“åºœçœŒ\u003c/label\u003e
\u003cselect name=\"prefecture\" class=\"form-select\" id=\"prefectureSelect\"\u003e
<option value="">ã™ã¹ã¦</option>
{% for pref in prefectures %}
\u003coption value=\"{{ pref }}\" {% if pref == prefecture %}selected{% endif %}\u003e{{ pref }}\u003c/option\u003e
{% endfor %}
\u003c/select\u003e
\u003c/div\u003e

\u003cdiv class=\"{% if request.GET %}col-md-2{% else %}search-field{% endif %}\"\u003e
\u003clabel class=\"form-label\"\u003eå¸‚åŒºç”ºæ‘\u003c/label\u003e
\u003cselect name=\"city\" id=\"citySelect\" class=\"form-select\"\u003e
\u003coption value=\"\"\u003eã™ã¹ã¦\u003c/option\u003e
{% if city %}
\u003coption value=\"{{ city }}\" selected\u003e{{ city }}\u003c/option\u003e
{% endif %}
\u003c/select\u003e
\u003c/div\u003e

\u003cdiv class=\"{% if request.GET %}col-md-2{% else %}search-field{% endif %}\"\u003e
\u003clabel class=\"form-label\"\u003eã‚«ãƒ†ã‚´ãƒª\u003c/label\u003e
\u003cselect name=\"category_name\" class=\"form-select\"\u003e
\u003coption value=\"\"\u003eã™ã¹ã¦\u003c/option\u003e
{% for category_name in category_names %}
\u003coption value=\"{{ category_name }}\" {% if category_name == request.GET.category_name %}selected{% endif %}\u003e
{{ category_name }}
\u003c/option\u003e
{% endfor %}
\u003c/select\u003e
\u003c/div\u003e

\u003cdiv class=\"{% if request.GET %}col-md-2{% else %}search-field{% endif %}\"\u003e
\u003clabel class=\"form-label\"\u003eåº—èˆ—å\u003c/label\u003e
\u003cinput type=\"text\" name=\"keyword\" class=\"form-control\" placeholder=\"ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢\" value=\"{{ keyword }}\"\u003e
\u003c/div\u003e

{% if request.GET %}
\u003cdiv class=\"col-md-2\"\u003e
\u003clabel class=\"form-label\"\u003eä¸¦ã³æ›¿ãˆ\u003c/label\u003e
\u003cselect name=\"sort\" class=\"form-select\"\u003e
\u003coption value=\"default\" {% if sort == \"default\" %}selected{% endif %}\u003eæ–°ã—ã„é †\u003c/option\u003e
\u003coption value=\"price_low\" {% if sort == \"price_low\" %}selected{% endif %}\u003eä¾¡æ ¼ãŒå®‰ã„é †\u003c/option\u003e
\u003coption value=\"price_high\" {% if sort == \"price_high\" %}selected{% endif %}\u003eä¾¡æ ¼ãŒé«˜ã„é †\u003c/option\u003e
\u003c/select\u003e
\u003c/div\u003e
{% endif %}

\u003cdiv class=\"{% if request.GET %}col-md-2 d-flex align-items-end{% else %}search-buttons{% endif %}\"\u003e
\u003cbutton type=\"submit\" class=\"btn btn-primary {% if not request.GET %}btn-lg w-100{% else %}me-2{% endif
%}\"\u003eğŸ” æ¤œç´¢\u003c/button\u003e
{% if request.GET %}
\u003ca href=\"{% url 'restaurants:restaurant_list' %}\" class=\"btn btn-outline-secondary\"\u003eã‚¯ãƒªã‚¢\u003c/a\u003e
{% endif %}
\u003c/div\u003e
\u003c/form\u003e
\u003c/div\u003e

{# ==== åº—èˆ—ãƒªã‚¹ãƒˆï¼ˆæ¨ªé•·ã‚«ãƒ¼ãƒ‰å½¢å¼ï¼‰ ==== #}
{% if restaurants %}
\u003cdiv class=\"restaurant-list\"\u003e
{% for restaurant in restaurants %}
\u003cdiv class=\"restaurant-card-horizontal mb-4\"\u003e
\u003cdiv class=\"restaurant-image\"\u003e
{% if restaurant.image %}
\u003cimg src=\"{{ restaurant.image.url }}\" alt=\"{{ restaurant.name }}\"\u003e
{% else %}
\u003cdiv class=\"no-image\"\u003eç”»åƒãªã—\u003c/div\u003e
{% endif %}
\u003c/div\u003e
\u003cdiv class=\"restaurant-info\"\u003e
\u003ch3 class=\"restaurant-name\"\u003e
\u003ca href=\"{% url 'restaurants:restaurant_detail' restaurant.pk %}\"\u003e{{ restaurant.name }}\u003c/a\u003e
\u003c/h3\u003e
\u003cp class=\"restaurant-category\"\u003e
\u003cspan class=\"badge bg-secondary\"\u003e{{ restaurant.category.name }}\u003c/span\u003e
{% if restaurant.prefecture %}\u003cspan class=\"ms-2 text-muted\"\u003eğŸ“ {{ restaurant.prefecture }} {% if
restaurant.city %}{{ restaurant.city }}{% endif %}\u003c/span\u003e{% endif %}
\u003c/p\u003e
{% if restaurant.description %}
\u003cp class=\"restaurant-description\"\u003e{{ restaurant.description|truncatewords:30 }}\u003c/p\u003e
{% endif %}
\u003cdiv class=\"restaurant-meta\"\u003e
{% if restaurant.price_min %}
\u003cspan class=\"price\"\u003eğŸ’° Â¥{{ restaurant.price_min }}ã€œ\u003c/span\u003e
{% endif %}
\u003cspan class=\"favorite-count ms-3\"\u003eâ¤ï¸ {{ restaurant.favorite_count|default:0 }}\u003c/span\u003e
\u003c/div\u003e
\u003c/div\u003e
\u003c/div\u003e
{% endfor %}
\u003c/div\u003e

{% elif request.GET %}
{# æ¤œç´¢ã—ãŸãŒçµæœãŒãªã„å ´åˆ #}
\u003cdiv class=\"text-center py-5\"\u003e
\u003ch4\u003eğŸ˜” æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ\u003c/h4\u003e
\u003cp class=\"text-muted\"\u003eåˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„æ¡ä»¶ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\u003c/p\u003e
\u003ca href=\"{% url 'restaurants:restaurant_list' %}\" class=\"btn btn-primary\"\u003eæ¤œç´¢æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢\u003c/a\u003e
\u003c/div\u003e
{% else %}
{# æ¤œç´¢å‰ï¼ˆåˆæœŸè¡¨ç¤ºï¼‰ #}
\u003cdiv class=\"text-center py-5\"\u003e
\u003ch3 class=\"text-muted\"\u003eä¸Šè¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãŠåº—ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„\u003c/h3\u003e
\u003cp class=\"text-muted\"\u003eéƒ½é“åºœçœŒã€å¸‚åŒºç”ºæ‘ã€ã‚«ãƒ†ã‚´ãƒªã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰æ¤œç´¢ã§ãã¾ã™ã€‚\u003c/p\u003e
\u003c/div\u003e
{% endif %}

\u003cstyle\u003e
/* æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.search-container {
max-width: 1200px;
margin: 0 auto 40px;
}

.search-form-large {
background: #f8f9fa;
padding: 40px;
border-radius: 12px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.search-field {
margin-bottom: 20px;
}

.search-buttons {
margin-top: 10px;
}

/* æ¨ªé•·ã‚«ãƒ¼ãƒ‰å½¢å¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.restaurant-list {
max-width: 1000px;
margin: 0 auto;
}

.restaurant-card-horizontal {
display: flex;
border: 1px solid #dee2e6;
border-radius: 12px;
overflow: hidden;
background: white;
transition: box-shadow 0.3s ease, transform 0.2s ease;
}

.restaurant-card-horizontal:hover {
box-shadow: 0 4px 20px rgba(0,0,0,0.12);
transform: translateY(-2px);
}

.restaurant-image {
width: 300px;
height: 200px;
flex-shrink: 0;
background: #f8f9fa;
display: flex;
align-items: center;
justify-content: center;
}

.restaurant-image img {
width: 100%;
height: 100%;
object-fit: cover;
}

.restaurant-image .no-image {
color: #6c757d;
font-size: 14px;
}

.restaurant-info {
flex: 1;
padding: 20px;
display: flex;
flex-direction: column;
gap: 10px;
}

.restaurant-name {
font-size: 1.5rem;
margin: 0;
font-weight: 600;
}

.restaurant-name a {
color: #212529;
text-decoration: none;
transition: color 0.2s;
}

.restaurant-name a:hover {
color: #0d6efd;
}

.restaurant-category {
margin: 0;
}

.restaurant-description {
color: #6c757d;
margin: 0;
font-size: 0.95rem;
line-height: 1.6;
}

.restaurant-meta {
display: flex;
align-items: center;
margin-top: auto;
font-size: 0.9rem;
color: #495057;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
.restaurant-card-horizontal {
flex-direction: column;
}

.restaurant-image {
width: 100%;
height: 180px;
}

.search-form-large {
padding: 20px;
}
}
\u003c/style\u003e

\u003cscript\u003e
// éƒ½é“åºœçœŒé¸æŠæ™‚ã«å¸‚åŒºç”ºæ‘ã‚’å‹•çš„ã«æ›´æ–°
document.addEventListener('DOMContentLoaded', function() {
const prefectureSelect = document.getElementById('prefectureSelect');
const citySelect = document.getElementById('citySelect');

if (prefectureSelect) {
prefectureSelect.addEventListener('change', function() {
const prefecture = this.value;

// å¸‚åŒºç”ºæ‘é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
citySelect.innerHTML = '\u003coption value=\"\"\u003eã™ã¹ã¦\u003c/option\u003e';

if (prefecture) {
// APIã‹ã‚‰å¸‚åŒºç”ºæ‘ã‚’å–å¾—
fetch(`/api/cities_by_prefecture/?prefecture=${encodeURIComponent(prefecture)}`)
.then(response =\u003e response.json())
.then(data =\u003e {
if (data.cities \u0026\u0026 data.cities.length \u003e 0) {
data.cities.forEach(city =\u003e {
const option = document.createElement('option');
option.value = city;
option.textContent = city;
citySelect.appendChild(option);
});
}
})
.catch(error =\u003e console.error('Error:', error));
}
});
}
});
\u003c/script\u003e

{% endblock %}