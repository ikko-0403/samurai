{% extends "base.html" %}
{% block title %}店舗一覧（管理） | NAGOYAMESHI{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">店舗一覧（管理）</h1>
  <a href="{% url 'restaurants:owner_restaurant_create' %}" class="btn btn-primary">
    ＋ 新規店舗追加
  </a>
</div>

<div class="card mb-4 bg-light">
  <div class="card-body p-3">
    <form method="get" action="" class="row g-2 align-items-end">

      <div class="col-md-5">
        <label for="keyword" class="form-label small text-muted">店舗名</label>
        <input type="text" name="keyword" id="keyword" class="form-control" placeholder="店舗名を検索" value="{{ keyword }}">
      </div>

      <div class="col-md-4">
        <label for="category" class="form-label small text-muted">カテゴリ</label>
        <select name="category" id="category" class="form-select">
          <option value="">全てのカテゴリ</option>
          {% for cat in categories %}
          <option value="{{ cat.id }}" {% if selected_category_id == cat.id|stringformat:"s" %}selected{% endif %}>
            {{ cat.name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3">
        <button type="submit" class="btn btn-primary w-100 mb-2">
          <i class="fas fa-search"></i> 検索
        </button>
        <a href="{% url 'restaurants:owner_restaurant_list' %}" class="btn btn-outline-secondary w-100 btn-sm">
          クリア
        </a>
      </div>
    </form>
  </div>
</div>



<table class="table table-sm table-striped align-middle">
  <thead>
    <tr>
      <th>ID</th>
      <th>店舗名</th>
      <th>会社</th>
      <th>カテゴリ</th>
      <th>価格帯</th>
      <th>営業時間</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for r in restaurants %}
    <tr>
      <td>{{ r.id }}</td>
      <td>{{ r.name }}</td>
      <td>{{ r.company.name }}</td>
      <td>{{ r.category.name }}</td>
      <td>¥{{ r.price_min }}〜¥{{ r.price_max }}</td>
      <td>{{ r.open_time }}〜{{ r.close_time }}</td>
      <td>
        <a href="{% url 'restaurants:owner_restaurant_update' r.pk %}" class="btn btn-sm btn-outline-secondary">
          編集
        </a>
        <a href="{% url 'restaurants:owner_restaurant_delete' r.pk %}" class="btn btn-sm btn-outline-danger">
          削除
        </a>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="7" class="text-muted">店舗がまだ登録されていません。</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="d-flex justify-content-end mt-3">
  <a href="{% url 'restaurants:owner_restaurant_csv' %}?{{ request.GET.urlencode }}" class="btn btn-primary">
    CSV出力
  </a>
</div>

{% endblock %}